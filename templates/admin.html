<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ç®¡ç†å‘˜æ“ä½œä¸­å¿ƒ-{{rules.count}}æ¡è§„åˆ™</title>
    <meta name="description" content="particles.js is a lightweight JavaScript library for creating particles.">
    <meta name="author" content="é“é•¿" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" media="screen" href="/static/css/admin.css">
    <link rel="icon" href="/static/img/logo.png" type="image/x-icon">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/common.js"></script>
    <script src="/static/js/grey.js"></script>
</head>

<body>
    <script>
        $(document).ready(function () {
            $(".view").click(function () {
                let rule = this.innerText.trim();
                location.href = '/admin/view/' + rule + '.js';
            });

            $(".view_home").click(function () {
                let rule = this.getAttribute('value').trim();
                location.href = '/vod?{% if js0_password %}pwd={{js0_password}}&{% endif %}rule=' + rule;
            });

            $(".view_search").click(function () {
                let rule = this.getAttribute('value').trim();
                location.href = '/vod?{% if js0_password %}pwd={{js0_password}}&{% endif %}rule=' + rule + '&wd=æ–—ç½—å¤§é™†';
            });

            $("#checkUpdate").click(function () {
                console.log('å¼€å§‹æ£€æŸ¥å‡çº§...');
                $.get("/admin/get_ver", function (data, status) {
                    console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                    if (data.msg) {
                        alert(data.msg);
                        return false
                    } else {
                        if (data.local_ver && data.online_ver && !data.msg) {
                            if (data.local_ver !== data.online_ver) {
                                msg = `æœ¬åœ°ç‰ˆæœ¬:${data.local_ver}\nçº¿ä¸Šç‰ˆæœ¬:${data.online_ver}\næ˜¯å¦ç«‹å³æ‰§è¡Œå‡çº§?`;
                                if (confirm(msg)) {
                                    $.get("/admin/update_ver", function (data, status) {
                                        console.log(data);
                                        if (data.code === 200) {
                                            // alert(data.msg+'\né™¤ä¸»ç¨‹åºapp.pyéœ€è¦è‡ªè¡Œæ£€æµ‹æ›¿æ¢å‡çº§å¤–,å…¶ä»–å…³é”®æ–‡ä»¶å…¨éƒ¨æ›´æ–°å®Œæ¯•');
                                            alert(data.msg);
                                            location.reload();
                                        } else {
                                            alert(data.msg || 'æœªçŸ¥æ•°æ®,å…·ä½“åˆ°æ•°æ®æ§åˆ¶å°æŸ¥çœ‹');
                                            console.log('å‡çº§å¤±è´¥äº†...');
                                            return false
                                        }
                                    });
                                }
                            } else {
                                alert('å·²ç»æ˜¯æœ€æ–°ç‰ˆ,æ— éœ€å‡çº§!')
                            }
                        } else if (data.msg) {
                            alert('æ£€æµ‹å‡çº§ç–‘ä¼¼å‘ç”Ÿäº†é—®é¢˜:\n' + data.msg);
                        } else {
                            alert('å·²ç»æ˜¯æœ€æ–°ç‰ˆ,æ— éœ€å‡çº§!')
                        }
                    }
                });
            });

            $(".clear").click(function () {
                let rule = this.getAttribute('value').trim();
                if (confirm('ç¡®è®¤åˆ é™¤å†…ç½®è§„åˆ™:' + rule + '?')) {
                    let code = $.ajax({ url: '/admin/clear/' + rule + '.js', async: false }).responseText;
                    code = typeof (code) === "object" ? code : JSON.parse(code);
                    if (code.code === 200) {
                        alert('æ“ä½œæˆåŠŸ!\n' + code.msg);
                        location.reload()
                    } else {
                        alert('æ“ä½œå¤±è´¥!\n' + code.msg);
                    }
                }
            });

            $('#upload').click(function () {
                var file_data = $("input[name='file']").prop("files")[0];
                // console.log(file_data);
                if (!file_data) {
                    alert('æ–‡ä»¶å¿…é€‰');
                    return false
                }
                var name = file_data.name;
                if (!name.endsWith('.js')) {
                    alert('ä»…æ”¯æŒä¸Šä¼ jsæ–‡ä»¶');
                    return false
                }
                var form_data = new FormData();
                // æŠŠæ‰€æœ‰è¡¨å•ä¿¡æ¯
                form_data.append("id", "001");
                form_data.append("name", name);
                form_data.append("file", file_data);
                $.ajax({
                    type: "POST",
                    url: "/admin/upload",
                    dataType: "json",
                    processData: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦å¤„ç†æ•°æ®
                    contentType: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦è®¾ç½®contentType
                    data: form_data
                }).success(function (ret) {
                    console.log(ret);
                    alert(ret.msg);
                    location.reload();
                }).fail(function (ret) {
                    console.log(ret);
                    alert(ret.msg);
                });
            });

            $('#update_lives').click(function () {
                let live_url = $('#live_url').val();
                // console.log(live_url);
                let new_live_url = prompt('è¾“å…¥ä¸´æ—¶åŒæ­¥è¿œç¨‹ç›´æ’­æºåœ°å€(è‡ªåŠ¨è·å–å½“å‰é…ç½®)', live_url);
                if (new_live_url.startsWith('http')) {
                    $.get("/admin/update_lives?url=" + new_live_url, function (data, status) {
                        console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                        if (data.code === 200) {
                            alert('æ“ä½œæˆåŠŸ!\n' + data.msg);
                            // location.reload();
                        } else {
                            alert('æ“ä½œå¤±è´¥!\n' + data.msg);
                        }
                    });
                }
            });

            $('#write_lives').click(function () {
                let live_url = $('#live_url').val();
                let new_live_url = prompt('è¯·ä¿®æ”¹é»˜è®¤çš„è¿œç¨‹ç›´æ’­æºåœ°å€', live_url);
                if (new_live_url) {
                    console.log('ä¿®æ”¹ç›´æ’­æºåœ°å€ä¸º:' + new_live_url);
                    $.get("/admin/write_live_url?url=" + new_live_url, function (data, status) {
                        console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                        if (data.code === 200) {
                            alert('æ“ä½œæˆåŠŸ!\n' + data.msg);
                            location.reload();
                        } else {
                            alert('æ“ä½œå¤±è´¥!\n' + data.msg);
                        }
                    });
                }
            });

            $('#force_update').click(function () {
                let msg = `
            å‡çº§è¿‡ç¨‹ä¸­ç”±äºæ–°ç‰ˆæœ¬å‡çº§è„šæœ¬å‘ç”Ÿæ”¹å˜å¯èƒ½ä¼šå¯¼è‡´å‡çº§å®Œæ¯•ä½†æ˜¯å‡çº§ä¸å®Œæ•´ã€‚
            æ­¤æ—¶éœ€è¦é‡å¯æœåŠ¡åæ‰§è¡Œå¼ºåˆ¶å‡çº§æ“ä½œé€šè¿‡æ›´æ–°åçš„å‡çº§è„šæœ¬æŠŠæœ¬åœ°å‡çº§åŒ…æ–‡ä»¶å†æ¬¡è¦†ç›–å®Œæˆå®Œæ•´å‡çº§ã€‚
            æ˜¯å¦ç»§ç»­(è¯·ç¡®è®¤ä½ å‡çº§å®Œåé‡å¯è¿‡,ä¸ç„¶ç‚¹ç¡®å®šæ¯«æ— å¿…è¦)?
            `;
                if (confirm(msg)) {
                    $.get("/admin/force_update", function (data, status) {
                        console.log(data);
                        if (data.code === 200) {
                            // alert(data.msg+'\né™¤ä¸»ç¨‹åºapp.pyéœ€è¦è‡ªè¡Œæ£€æµ‹æ›¿æ¢å‡çº§å¤–,å…¶ä»–å…³é”®æ–‡ä»¶å…¨éƒ¨æ›´æ–°å®Œæ¯•');
                            alert(data.msg);
                            location.reload();
                        } else {
                            alert(data.msg || 'æœªçŸ¥æ•°æ®,å…·ä½“åˆ°æ•°æ®æ§åˆ¶å°æŸ¥çœ‹');
                            console.log('å‡çº§å¤±è´¥äº†...');
                            return false
                        }
                    });
                }
            });

            $('#use_py').click(function () {
                $.get("/admin/change_use_py", function (data, status) {
                    console.log(data);
                    if (data.code === 200) {
                        alert(data.msg);
                        location.reload();
                    } else {
                        alert(data.msg);
                        console.log('å‡çº§å¤±è´¥äº†...');
                        return false
                    }
                });
            });

            $("#logtail").click(function () {
                location.href = '/admin/logtail';
            });

            $('#lives').click(function () {
                location.href = '/admin/lives'
            });
            $("summary").click(function() {
                // console.log('summaryè¢«ç‚¹å‡»');
                const details = $('details');
                if(details.attr("open")){
                    $(this).text('æ•°æ®åˆ—è¡¨å·²éšè— ç‚¹å‡»å±•å¼€è¯¦æƒ…');
                }else{
                    $(this).text('æ•°æ®åˆ—è¡¨å·²å±•å¼€ ç‚¹å‡»éšè—è¯¦æƒ…');
                }
                details.click();
            });

        });
        function getFileSize(fileObj) {
            $('#file_size').text('æ–‡ä»¶å¤§å°ä¸º:' + fileObj.files[0].size / 1024 + 'kb');
        }
    </script>
    <div class="title">æ¬¢è¿ä½¿ç”¨DR-PYç®¡ç†ç•Œé¢<div><span class="ver_title">å½“å‰ç‰ˆæœ¬: {{ ver }}</span><span
                class="ver_title">æ¡†æ¶å¼€å‘ï¼šé“é•¿</span><span class="ver_title">æ¡†æ¶ç¾åŒ–ï¼šè“è“</span></div>
    </div>
    <a href="/web/player1?url=" class="btn-player" target="_blank">MUIæ’­æ”¾å™¨</a>
    <a href="/web/player2?url=" class="btn-player" target="_blank">P2Pæ’­æ”¾å™¨</a>
    <a href="/web/player3?url=https://vip.ffzyread1.com/20230601/13234_55ed2d56/index.m3u8" class="btn-player" target="_blank">P2Pæ’­æ”¾å™¨-GO</a>
        <div class="nav">
            <!-- åˆ—è¡¨ -->
            <ul>
                <!-- ä¸€çº§èœå• -->
                <li class="nav-litem">
                    <a href="/index">è¿”å›é¦–é¡µ</a>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">åŠŸèƒ½ç®¡ç†</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="/admin/settings">è®¾ç½®ä¸­å¿ƒ</a></li>
                        <li><a href="/layui/index">æœªæ¥åŠŸèƒ½</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="logtail">åœ¨çº¿æ—¥å¿—</a></li>
                        <li><a href="/vods" class="funcbtn" target="_blank">æœç´¢çœ‹æ¿</a></li>
                    </ul>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">é¡¹ç›®å‡çº§</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="javascript:void(0);" class="funcbtn" id="checkUpdate">æ£€æµ‹å‡çº§</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="force_update">å¼ºåˆ¶å‡çº§</a></li>
                    </ul>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">ç›´æ’­è®¾ç½®</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="javascript:void(0);" class="funcbtn" id="write_lives">ä¿®æ”¹ç›´æ’­æº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="update_lives">åŒæ­¥ç›´æ’­æº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="use_py">å·²{% if pystate=='1' %}å¯ç”¨{% else %}å…³é—­{% endif %}pyæº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="lives">ç›´æ’­æºåˆ—è¡¨</a></li>
                    </ul>
                </li>

               
            </ul>
        </div>


        <input id="live_url" value="{{live_url}}" style="display: none">
        <p class="box">ä½ å¯ä»¥åœ¨æ­¤ç•Œé¢åœ¨çº¿ç®¡ç†JSç›®å½•é‡Œè§„åˆ™æ–‡ä»¶çš„ä¸Šä¼ /åˆ é™¤</p>
  
    <form action="/admin/upload" method="POST" enctype="multipart/form-data">
        <!--     <input type = "file" name = "file" class="btn" accept=".js"  onchange="getFileSize(this)"/>-->
        <input type="file" name="file" class="btn" onchange="getFileSize(this)" />
        <!--     <input type = "submit" value="ä¸Šä¼ " class="btn"/>-->
        <input type="button" id="upload" value="ä¸Šä¼ " class="btn" />
    </form>
    <p id="file_size"></p>
     <details open>
          <summary class="xl">æ•°æ®åˆ—è¡¨å·²å±•å¼€ ç‚¹å‡»éšè—è¯¦æƒ…</summary>
    <h4>è§„åˆ™åˆ—è¡¨æ•°æ®-å…±{{rules.count+cache_count}}æ¡(å†…ç½®:{{rules.count}} ç¼“å­˜:{{cache_count}})</h4>
    {% if rules.count < 1 %} <h3>æš‚æ— å†…ç½®çš„è§„åˆ™</h3>
        {% endif %}
        <div class="zt">
            {% for rule in rules.list %}
            <div class="red">
                <div class="mz"><a class="view" href="javascript:void(0);">{{ rule.name }}</a></div>
                <div class="sa"><a class="preview_home" href="/web/{{ rule.name }}/mxpro" value="{{ rule.name }}" target="_blank">ğŸŒ</a></div>
                <div class="sj"><a class="view_home" href="javascript:void(0);" value="{{ rule.name }}">ğŸ </a></div>
                <div class="ss"><a class="view_search" href="javascript:void(0);" value="{{ rule.name }}">ğŸ”ï¸</a></div>
                <div class="sc"><a class="clear" href="javascript:void(0);" value="{{ rule.name }}">ğŸ—‘</a></div>
            </div>
            {% endfor %}
        </div>
    </details>
</body>

</html>