<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ç®¡ç†å‘˜æ“ä½œä¸­å¿ƒ-{{rules.count}}æ¡è§„åˆ™</title>
    <meta name="description" content="particles.js is a lightweight JavaScript library for creating particles.">
    <meta name="author" content="é“é•¿" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" media="screen" href="/static/css/admin.css">
    <link rel="icon" href="/static/img/logo.png" type="image/x-icon">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/common.js"></script>
    <script src="/static/js/grey.js"></script>
</head>

<body>
    <script>
        $(document).ready(function () {
            function isPhone() {
                //è·å–æµè§ˆå™¨navigatorå¯¹è±¡çš„userAgentå±æ€§ï¼ˆæµè§ˆå™¨ç”¨äºHTTPè¯·æ±‚çš„ç”¨æˆ·ä»£ç†å¤´çš„å€¼ï¼‰
                var info = navigator.userAgent;
                var isMobile = /iPhone|iPad|iPod|Android|mobile/i.test(info) || window.screen.width < 768 || window.screen.height < 768;
                console.log('navigator.userAgent:',info,'isMobile:',isMobile);
                //é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„testæ–¹æ³•åˆ¤æ–­æ˜¯å¦åŒ…å«â€œMobileâ€å­—ç¬¦ä¸²
                //å¦‚æœåŒ…å«â€œMobileâ€ï¼ˆæ˜¯æ‰‹æœºè®¾å¤‡ï¼‰åˆ™è¿”å›true
                return isMobile;
            }
            const IS_MOBILE = isPhone();
            console.log('IS_MOBILE:',IS_MOBILE);
            $(".view").click(function () {
                let rule = this.innerText.trim();
                // location.href = '/admin/view/' + rule + '.js';
                if(IS_MOBILE){
                    location.href = '/admin/edit2/' + rule + '.js';
                }else{
                    location.href = '/admin/edit/' + rule + '.js';
                }
            });

            $(".view_home").click(function () {
                let rule = this.getAttribute('value').trim();
                location.href = '/vod?{% if js0_password %}pwd={{js0_password}}&{% endif %}rule=' + rule;
            });

            $(".view_search").click(function () {
                let rule = this.getAttribute('value').trim();
                location.href = '/vod?{% if js0_password %}pwd={{js0_password}}&{% endif %}rule=' + rule + '&wd=æ–—ç½—å¤§é™†';
            });

            $("#checkUpdate").click(function () {
                console.log('å¼€å§‹æ£€æŸ¥å‡çº§...');
                $.get("/admin/get_ver", function (data, status) {
                    console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                    if (data.msg) {
                        alert(data.msg);
                        return false
                    } else {
                        if (data.local_ver && data.online_ver && !data.msg) {
                            if (data.local_ver !== data.online_ver) {
                                msg = `æœ¬åœ°ç‰ˆæœ¬:${data.local_ver}\nçº¿ä¸Šç‰ˆæœ¬:${data.online_ver}\næ˜¯å¦ç«‹å³æ‰§è¡Œå‡çº§?`;
                                if (confirm(msg)) {
                                    $.get("/admin/update_ver", function (data, status) {
                                        console.log(data);
                                        if (data.code === 200) {
                                            // alert(data.msg+'\né™¤ä¸»ç¨‹åºapp.pyéœ€è¦è‡ªè¡Œæ£€æµ‹æ›¿æ¢å‡çº§å¤–,å…¶ä»–å…³é”®æ–‡ä»¶å…¨éƒ¨æ›´æ–°å®Œæ¯•');
                                            alert(data.msg);
                                            location.reload();
                                        } else {
                                            alert(data.msg || 'æœªçŸ¥æ•°æ®,å…·ä½“åˆ°æ•°æ®æ§åˆ¶å°æŸ¥çœ‹');
                                            console.log('å‡çº§å¤±è´¥äº†...');
                                            return false
                                        }
                                    });
                                }
                            } else {
                                alert('å·²ç»æ˜¯æœ€æ–°ç‰ˆ,æ— éœ€å‡çº§!')
                            }
                        } else if (data.msg) {
                            alert('æ£€æµ‹å‡çº§ç–‘ä¼¼å‘ç”Ÿäº†é—®é¢˜:\n' + data.msg);
                        } else {
                            alert('å·²ç»æ˜¯æœ€æ–°ç‰ˆ,æ— éœ€å‡çº§!')
                        }
                    }
                });
            });

            $(".clear").click(function () {
                let rule = this.getAttribute('value').trim();
                if (confirm('ç¡®è®¤åˆ é™¤å†…ç½®è§„åˆ™:' + rule + '?')) {
                    let code = $.ajax({ url: '/admin/clear/' + rule + '.js', async: false }).responseText;
                    code = typeof (code) === "object" ? code : JSON.parse(code);
                    if (code.code === 200) {
                        alert('æ“ä½œæˆåŠŸ!\n' + code.msg);
                        location.reload()
                    } else {
                        alert('æ“ä½œå¤±è´¥!\n' + code.msg);
                    }
                }
            });

            $('#upload').click(function () {
                var file_data = $("input[name='file']").prop("files")[0];
                // console.log(file_data);
                if (!file_data) {
                    alert('æ–‡ä»¶å¿…é€‰');
                    return false
                }
                var name = file_data.name;
                if (!name.endsWith('.js')) {
                    alert('ä»…æ”¯æŒä¸Šä¼ jsæ–‡ä»¶');
                    return false
                }
                var form_data = new FormData();
                // æŠŠæ‰€æœ‰è¡¨å•ä¿¡æ¯
                form_data.append("id", "001");
                form_data.append("name", name);
                form_data.append("file", file_data);
                $.ajax({
                    type: "POST",
                    url: "/admin/upload",
                    dataType: "json",
                    processData: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦å¤„ç†æ•°æ®
                    contentType: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦è®¾ç½®contentType
                    data: form_data
                }).success(function (ret) {
                    console.log(ret);
                    if(ret.msg && ret.msg.includes('æ–‡ä»¶å·²å­˜åœ¨')){
                        if (confirm(ret.msg+'\n'+'æ˜¯å¦è¦†ç›–å†™å…¥?')) {
                        console.log('è¦†ç›–å†™å…¥');
                        $.ajax({
                            type: "POST",
                            url: "/admin/upload?force=1",
                            dataType: "json",
                            processData: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦å¤„ç†æ•°æ®
                            contentType: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦è®¾ç½®contentType
                            data: form_data
                        }).success((ret)=>{
                            console.log(ret);
                            alert(ret.msg);
                            if(ret.msg && ret.msg.includes('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ')){
                                location.reload();
                            }
                        }).fail((ret)=>{
                            console.log(ret);
                            alert(ret.msg);
                        });
                        }
                    }else{
                        alert(ret.msg);
                    }
                    if(ret.msg && ret.msg.includes('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ')){
                        location.reload();
                    }
                }).fail(function (ret) {
                    console.log(ret);
                    alert(ret.msg);
                });
            });

            $('#update_lives').click(function () {
                let live_url = $('#live_url').val();
                // console.log(live_url);
                let new_live_url = prompt('è¾“å…¥ä¸´æ—¶åŒæ­¥è¿œç¨‹ç›´æ’­æºåœ°å€(è‡ªåŠ¨è·å–å½“å‰é…ç½®)', live_url);
                if (new_live_url.startsWith('http')) {
                    $.get("/admin/update_lives?url=" + new_live_url, function (data, status) {
                        console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                        if (data.code === 200) {
                            alert('æ“ä½œæˆåŠŸ!\n' + data.msg);
                            // location.reload();
                        } else {
                            alert('æ“ä½œå¤±è´¥!\n' + data.msg);
                        }
                    });
                }
            });

            $('#write_lives').click(function () {
                let live_url = $('#live_url').val();
                let new_live_url = prompt('è¯·ä¿®æ”¹é»˜è®¤çš„è¿œç¨‹ç›´æ’­æºåœ°å€', live_url);
                if (new_live_url) {
                    console.log('ä¿®æ”¹ç›´æ’­æºåœ°å€ä¸º:' + new_live_url);
                    $.get("/admin/write_live_url?url=" + new_live_url, function (data, status) {
                        console.log("æ•°æ®: " + data + "\nçŠ¶æ€: " + status);
                        if (data.code === 200) {
                            alert('æ“ä½œæˆåŠŸ!\n' + data.msg);
                            location.reload();
                        } else {
                            alert('æ“ä½œå¤±è´¥!\n' + data.msg);
                        }
                    });
                }
            });

            $('#force_update').click(function () {
                let msg = `
            å‡çº§è¿‡ç¨‹ä¸­ç”±äºæ–°ç‰ˆæœ¬å‡çº§è„šæœ¬å‘ç”Ÿæ”¹å˜å¯èƒ½ä¼šå¯¼è‡´å‡çº§å®Œæ¯•ä½†æ˜¯å‡çº§ä¸å®Œæ•´ã€‚
            æ­¤æ—¶éœ€è¦é‡å¯æœåŠ¡åæ‰§è¡Œå¼ºåˆ¶å‡çº§æ“ä½œé€šè¿‡æ›´æ–°åçš„å‡çº§è„šæœ¬æŠŠæœ¬åœ°å‡çº§åŒ…æ–‡ä»¶å†æ¬¡è¦†ç›–å®Œæˆå®Œæ•´å‡çº§ã€‚
            æ˜¯å¦ç»§ç»­(è¯·ç¡®è®¤ä½ å‡çº§å®Œåé‡å¯è¿‡,ä¸ç„¶ç‚¹ç¡®å®šæ¯«æ— å¿…è¦)?
            `;
                if (confirm(msg)) {
                    $.get("/admin/force_update", function (data, status) {
                        console.log(data);
                        if (data.code === 200) {
                            // alert(data.msg+'\né™¤ä¸»ç¨‹åºapp.pyéœ€è¦è‡ªè¡Œæ£€æµ‹æ›¿æ¢å‡çº§å¤–,å…¶ä»–å…³é”®æ–‡ä»¶å…¨éƒ¨æ›´æ–°å®Œæ¯•');
                            alert(data.msg);
                            location.reload();
                        } else {
                            alert(data.msg || 'æœªçŸ¥æ•°æ®,å…·ä½“åˆ°æ•°æ®æ§åˆ¶å°æŸ¥çœ‹');
                            console.log('å‡çº§å¤±è´¥äº†...');
                            return false
                        }
                    });
                }
            });

            $('#choose_update').click(function () {
                $('#fileInput').click();
            });

            $('#fileInput').change(function () {
                //è·å–é€‰æ‹©çš„æ–‡ä»¶ä¿¡æ¯
                let file = this.files[0];
                //æ‰§è¡Œä¸Šä¼ æ“ä½œ
                if(file){
                    console.log(file);
                    if(file.name.includes('dr_py')||file.name.includes('drpy')){
                        if(confirm('å·²é€‰æ‹©æ–‡ä»¶:'+file.name+',ä½“ç§¯:'+(file.size/1024).toFixed(2)+'kb è¿›è¡Œæ‰‹åŠ¨å‡çº§,æ˜¯å¦ç»§ç»­?')){
                            var name = file.name;
                            if (!name.endsWith('.zip')) {
                                alert('ä»…æ”¯æŒä¸Šä¼ zipæ–‡ä»¶');
                                return false
                            }
                            let form_data = new FormData();
                            // æŠŠæ‰€æœ‰è¡¨å•ä¿¡æ¯
                            form_data.append("id", "001");
                            form_data.append("name", name);
                            form_data.append("file", file);
                            $.ajax({
                                type: "POST",
                                url: "/admin/upload_update?force=1",
                                dataType: "json",
                                processData: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦å¤„ç†æ•°æ®
                                contentType: false,  // æ³¨æ„ï¼šè®©jQueryä¸è¦è®¾ç½®contentType
                                data: form_data
                            }).success(function (ret) {
                                console.log(ret);
                                alert(ret.msg);
                                if(ret.msg && ret.msg.includes('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ')){
                                    location.reload();
                                }
                            }).fail(function (ret) {
                                console.log(ret);
                                alert(ret.msg);
                            });
                        }
                    }else{
                        alert('ä½ é€‰æ‹©çš„æ–‡ä»¶:'+file.name+'çœ‹èµ·æ¥ä¸åƒæ˜¯drpyçš„å‡çº§æ–‡ä»¶å‹ç¼©åŒ…ã€‚ä¸€èˆ¬æ–‡ä»¶åé•¿è¿™æ ·:dr_py-main.zipï¼Œè¯·é‡æ–°é€‰æ‹©')
                    }
                }
            });

            $('#use_py').click(function () {
                $.get("/admin/change_use_py", function (data, status) {
                    console.log(data);
                    if (data.code === 200) {
                        alert(data.msg);
                        location.reload();
                    } else {
                        alert(data.msg);
                        console.log('å‡çº§å¤±è´¥äº†...');
                        return false
                    }
                });
            });

            $('#force_up').click(function () {
                $.get("/admin/change_force_up", function (data, status) {
                    console.log(data);
                    if (data.code === 200) {
                        alert(data.msg);
                        location.reload();
                    } else {
                        alert(data.msg);
                        console.log('å‡çº§å¤±è´¥äº†...');
                        return false
                    }
                });
            });

            $("#logtail").click(function () {
                location.href = '/admin/logtail';
            });

            $('#clear_drop').click(function () {
                if(confirm('è‹¥jsç›®å½•å­˜åœ¨åŒåçš„jsdæ–‡ä»¶åˆ™è§†ä¸ºè¯¥æºä¸ºåºŸå¼ƒæºã€‚æ‰§è¡Œæ­¤åŠŸèƒ½å°†æ¸…ç†ä¸jsdæ–‡ä»¶åŒåçš„jsæ–‡ä»¶ã€‚æ‰§è¡Œæ­¤åŠŸèƒ½å‰è¯·ç¡®ä¿é¡¹ç›®çš„jsdæ–‡ä»¶è·Ÿä»“åº“ä¸€è‡´ï¼Œé˜²æ­¢è¯¯åˆ ã€‚æ¨èè¿›å®¹å™¨ rm -rf js/*.jsd åå¼ºåˆ¶å‡çº§ä¸€æ¬¡å†ä½¿ç”¨æ­¤åŠŸèƒ½,åç»­å‡çº§æ—¶ä¼šè‡ªåŠ¨æ¸…ç©ºæ—§ç‰ˆjsdæ–‡ä»¶ã€‚ç«‹å³æ‰§è¡Œåˆ™ç¡®è®¤å¦åˆ™å–æ¶ˆæ‰§è¡Œ')){
                    $.get("/admin/clear_drop", function (data, status) {
                        console.log(data);
                        if (data.code === 200) {
                            alert(data.msg);
                            location.reload();
                        } else {
                            alert(data.msg);
                            console.log('æ¸…ç†å¤±è´¥äº†...');
                            return false
                        }
                    });
                }
            });

            $('#lives').click(function () {
                location.href = '/admin/lives'
            });
            $('#lives_web').click(function () {
                open('/admin/lives_web');
            });

            $('#live_tools').click(function (){
                open('/admin/tools');
            })

            $("summary").click(function() {
                // console.log('summaryè¢«ç‚¹å‡»');
                const details = $('details');
                if(details.attr("open")){
                    $(this).text('æ•°æ®åˆ—è¡¨å·²éšè— ç‚¹å‡»å±•å¼€è¯¦æƒ…');
                }else{
                    $(this).text('æ•°æ®åˆ—è¡¨å·²å±•å¼€ ç‚¹å‡»éšè—è¯¦æƒ…');
                }
                details.click();
            });

        });
        function getFileSize(fileObj) {
            $('#file_size').text('æ–‡ä»¶å¤§å°ä¸º:' + (fileObj.files[0].size / 1024).toFixed(2) + 'kb');
        }
    </script>
    <div class="title">æ¬¢è¿ä½¿ç”¨DR-PYç®¡ç†ç•Œé¢<div><span class="ver_title">å½“å‰ç‰ˆæœ¬: {{ ver }}</span><span
                class="ver_title">æ¡†æ¶å¼€å‘ï¼šé“é•¿</span><span class="ver_title">æ¡†æ¶ç¾åŒ–ï¼šè“è“</span></div>
    </div>
    <a href="/web/player1?url=" class="btn-player" target="_blank">MUIæ’­æ”¾å™¨</a>
    <a href="/web/player2?url=" class="btn-player" target="_blank">P2Pæ’­æ”¾å™¨</a>
    <a href="/web/player3?url=https://vip.ffzyread1.com/20230601/13234_55ed2d56/index.m3u8" class="btn-player" target="_blank">P2Pæ’­æ”¾å™¨-GO</a>
    <a href="/web/player4?url=" class="btn-player" target="_blank">P2Pæ’­æ”¾å™¨-hls</a>
        <div class="nav">
            <!-- åˆ—è¡¨ -->
            <ul>
                <!-- ä¸€çº§èœå• -->
                <li class="nav-litem">
                    <a href="/index">è¿”å›é¦–é¡µ</a>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">åŠŸèƒ½ç®¡ç†</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="/admin/settings">è®¾ç½®ä¸­å¿ƒ</a></li>
                        <li><a href="/layui/index">æœªæ¥åŠŸèƒ½</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="logtail">åœ¨çº¿æ—¥å¿—</a></li>
                        <li><a href="/vods" class="funcbtn" target="_blank">æœç´¢çœ‹æ¿</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="clear_drop">åºŸå¼ƒæºæ¸…ç†</a></li>
                    </ul>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">é¡¹ç›®å‡çº§</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="javascript:void(0);" class="funcbtn" id="checkUpdate">æ£€æµ‹å‡çº§</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="force_update">å¼ºåˆ¶å‡çº§</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="choose_update">æ‰‹åŠ¨å‡çº§</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="force_up">å·²{% if force_up=='1' %}å¯ç”¨{% else %}å…³é—­{% endif %}å¼ºåˆ¶ä¸‹è½½</a></li>
                        <input type="file" id="fileInput" accept=".zip,.rar" style="display:none;">
                    </ul>
                </li>

                <li class="nav-litem">
                    <a href="javascript:;">ç›´æ’­è®¾ç½®</a>
                    <!-- äºŒçº§èœå• -->
                    <ul>
                        <li><a href="javascript:void(0);" class="funcbtn" id="write_lives">ä¿®æ”¹ç›´æ’­æº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="update_lives">åŒæ­¥ç›´æ’­æº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="use_py">å·²{% if pystate=='1' %}å¯ç”¨{% else %}å…³é—­{% endif %}pyæº</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="lives">ç›´æ’­æºåˆ—è¡¨</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="lives_web">ç½‘é¡µåœ¨çº¿ç›´æ’­</a></li>
                        <li><a href="javascript:void(0);" class="funcbtn" id="live_tools">è½¬æ¢å·¥å…·</a></li>
                    </ul>
                </li>

               
            </ul>
        </div>


        <input id="live_url" value="{{live_url}}" style="display: none">
        <p class="box">ä½ å¯ä»¥åœ¨æ­¤ç•Œé¢åœ¨çº¿ç®¡ç†JSç›®å½•é‡Œè§„åˆ™æ–‡ä»¶çš„ä¸Šä¼ /åˆ é™¤</p>
  
    <form action="/admin/upload" method="POST" enctype="multipart/form-data">
        <!--     <input type = "file" name = "file" class="btn" accept=".js"  onchange="getFileSize(this)"/>-->
        <input type="file" name="file" class="btn" onchange="getFileSize(this)" accept=".js,.jsd,.txt"/>
        <!--     <input type = "submit" value="ä¸Šä¼ " class="btn"/>-->
        <input type="button" id="upload" value="ä¸Šä¼ " class="btn" />
    </form>
    <p id="file_size"></p>
     <details open>
          <summary class="xl">æ•°æ®åˆ—è¡¨å·²å±•å¼€ ç‚¹å‡»éšè—è¯¦æƒ…</summary>
    <h4>è§„åˆ™åˆ—è¡¨æ•°æ®-å…±{{rules.count+cache_count}}æ¡(å†…ç½®:{{rules.count}} ç¼“å­˜:{{cache_count}})</h4>
    {% if rules.count < 1 %} <h3>æš‚æ— å†…ç½®çš„è§„åˆ™</h3>
        {% endif %}
        <div class="zt">
            {% for rule in rules.list %}
            <div class="red">
                <div class="mz"><a class="view" href="javascript:void(0);">{{ rule.name }}</a></div>
                <div class="sa"><a class="preview_home" href="/web/{{ rule.name }}/mxpro" value="{{ rule.name }}" target="_blank">ğŸŒ</a></div>
                <div class="sj"><a class="view_home" href="javascript:void(0);" value="{{ rule.name }}">ğŸ </a></div>
                <div class="ss"><a class="view_search" href="javascript:void(0);" value="{{ rule.name }}">ğŸ”ï¸</a></div>
                <div class="sc"><a class="clear" href="javascript:void(0);" value="{{ rule.name }}">ğŸ—‘</a></div>
            </div>
            {% endfor %}
        </div>
    </details>
</body>

</html>